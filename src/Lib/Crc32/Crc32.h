//
// Created by WANG Zhenxiang Pharrell on 2019-07-08.
//

#ifndef CRC_CRC32_H
#define CRC_CRC32_H

#include <iostream>
#include <vector>

/*
Default example:
calculate the CRC-32 hash for the ASCII string 'abc'

 01100001 01100010 01100011  -- 3 Input bytes

 01100001011000100110001100000000000000000000000000000000
  100000100110000010001110110110111  --- generator polynomial
  ---------------------------------
   100000010100100010010001101101110000000000000000000000
   100000100110000010001110110110111
   ---------------------------------
         110010100000011111011011001000000000000000000000
         100000100110000010001110110110111
         ---------------------------------
          10010000110011101010101111110111000000000000000
          100000100110000010001110110110111
          ---------------------------------
             10010101011100010010100101100100000000000000
             100000100110000010001110110110111
             ---------------------------------
                10111000100011010011110111111100000000000
                100000100110000010001110110110111
                ---------------------------------
                  111010111011011011001100100111100000000
                  100000100110000010001110110110111
                  ---------------------------------
                   11010011101011001000010010001011000000
                   100000100110000010001110110110111
                   ---------------------------------
                    1010001110011000000101001010000100000
                    100000100110000010001110110110111
                    ---------------------------------
                      10000111111000100110100111101010000
                      100000100110000010001110110110111
                      ---------------------------------
                         00101100000101110011100110001100 -- CRC

                         0010 1100 0001 0111 0011 1001 1000 1100 -- CRC grouped by four digits

*/

class Crc32 {
private:
    std::vector<uint8_t> m_inputBytes;

    uint32_t m_len; // len of inputBytes in bytes
    uint32_t m_truncPoly; // the generator
    uint32_t m_width; // len of m_truncPoly in bits
    uint32_t m_table[256]; // the lookup table

    void xInitTable();
public:
    explicit Crc32(uint8_t *arr, uint32_t theLen = 3, uint32_t poly = 0x04C11DB7, uint32_t width = 32);

    ~Crc32();

    /*!
     * Get CRC bitwise, it is very slow thus not suitable fo real world application
     * */
    uint32_t getCRCSlow();

    /*!
     * Get CRC using lookup table, handles the input stream bytewise
     * */
    uint32_t getCRC();

};


#endif //CRC_CRC32_H
